<!-- Modal de Feedback Bonito -->
<div id="feedback-modal" style="
  display:none;
  position:fixed;
  inset:0;
  backdrop-filter:blur(4px);
  background:rgba(0,0,0,0.35);
  z-index:9999;
  align-items:center;
  justify-content:center;
  animation: fadeIn .25s ease-out;
">

  <div style="
    background: #ffffff;
    padding: 28px 24px;
    border-radius: 14px;
    max-width: 420px;
    width: 92%;
    box-shadow: 0 8px 28px rgba(0,0,0,0.15);
    animation: scaleIn .25s ease-out;
    font-family: sans-serif;
  ">

    <h2 style="margin:0 0 10px 0; color:#2b2b2b; font-size:20px; text-align:center;">
      üòä Gostou da experi√™ncia?
    </h2>

    <p style="margin:0 0 18px 0; color:#555; font-size:14px; text-align:center;">
      Sua opini√£o nos ajuda a evoluir e deixar o simulador cada vez melhor.
    </p>

    <!-- ‚≠ê Estrelas de avalia√ß√£o -->
    <div id="star-container" style="display:flex; justify-content:center; gap:8px; margin-bottom:15px; cursor:pointer;">
      <span class="star" data-value="1" style="font-size:28px; color:#ccc;">‚òÖ</span>
      <span class="star" data-value="2" style="font-size:28px; color:#ccc;">‚òÖ</span>
      <span class="star" data-value="3" style="font-size:28px; color:#ccc;">‚òÖ</span>
      <span class="star" data-value="4" style="font-size:28px; color:#ccc;">‚òÖ</span>
      <span class="star" data-value="5" style="font-size:28px; color:#ccc;">‚òÖ</span>
    </div>

    <input type="hidden" id="fb-nota" value="5">

    <!-- Coment√°rio -->
    <textarea id="fb-coment" rows="3" placeholder="Conte rapidamente como podemos melhorar üòä"
      style="
        width:100%;
        border:1px solid #ddd;
        border-radius:8px;
        padding:10px;
        font-size:14px;
        resize:none;
        outline:none;
        transition:.2s;
      "
      onfocus="this.style.borderColor='#4a7ae0'"></textarea>

    <!-- Bot√µes -->
    <div style="display:flex; justify-content:space-between; margin-top:20px;">
      <button onclick="document.getElementById('feedback-modal').style.display='none'"
        style="
          background:#eee;
          border:none;
          padding:10px 14px;
          border-radius:8px;
          cursor:pointer;
          font-size:14px;
        ">
        Fechar
      </button>

      <button id="fb-enviar"
        style="
          background:#4a7ae0;
          color:white;
          border:none;
          padding:10px 18px;
          border-radius:8px;
          cursor:pointer;
          font-size:14px;
          box-shadow:0 2px 6px rgba(0,0,0,0.15);
          transition:.2s;
        "
        onmouseover="this.style.opacity='0.92'"
        onmouseout="this.style.opacity='1'">
        Enviar Avalia√ß√£o
      </button>
    </div>

  </div>
</div>

<!-- Anima√ß√µes -->
<style>
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
@keyframes scaleIn { from { transform:scale(0.9); opacity:0;} to {transform:scale(1); opacity:1;} }
</style>

<script>
  const APPS_SCRIPT_URL = "{{ apps_script_url }}";

  // ‚≠ê Sistema de estrelas
  document.addEventListener("DOMContentLoaded", () => {
    const stars = document.querySelectorAll("#star-container .star");
    const notaInput = document.getElementById("fb-nota");

    stars.forEach(star => {
      star.addEventListener("mouseover", () => {
        highlightStars(star.dataset.value);
      });

      star.addEventListener("click", () => {
        notaInput.value = star.dataset.value;
      });
    });

    function highlightStars(nota) {
      stars.forEach(s => {
        s.style.color = Number(s.dataset.value) <= Number(nota) ? "#ffaa00" : "#ccc";
      });
    }

    highlightStars(5);
  });

  // ‚≠ê Enviar Feedback
  function showFeedback(simuladorNome) {
    const modal = document.getElementById('feedback-modal');
    modal.style.display = "flex";

    document.getElementById("fb-enviar").onclick = async () => {

      const dados = {
        simulador: simuladorNome,
        nota: Number(document.getElementById("fb-nota").value),
        comentario: document.getElementById("fb-coment").value,
        usuario: ""
      };

      try {
        await fetch(APPS_SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(dados)
        });

        // Mensagem suave
        alert("‚ú® Obrigado! Sua opini√£o faz toda a diferen√ßa.");

      } catch (e) {
        alert("‚ùå N√£o foi poss√≠vel enviar agora. Tente mais tarde.");
      }

      modal.style.display = "none";
    };
  }
</script>
